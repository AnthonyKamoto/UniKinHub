{% extends 'base.html' %} {% block title %}Créer une actualité - Actualités
Étudiantes Kinshasa{% endblock %} {% block content %}
<div class="row">
    <div class="col-md-8 mx-auto">
        <div class="card">
            <div class="card-header">
                <h4>
                    <i class="fas fa-plus-circle me-2"></i>Créer une nouvelle
                    actualité
                </h4>
            </div>
            <div class="card-body">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}

                    <div class="mb-3">
                        <label
                            for="{{ form.title.id_for_label }}"
                            class="form-label"
                            >{{ form.title.label }} *</label
                        >
                        {{ form.title }} {% if form.title.errors %}
                        <div class="text-danger small">
                            {{ form.title.errors.0 }}
                        </div>
                        {% endif %}
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label
                                for="{{ form.category.id_for_label }}"
                                class="form-label"
                                >{{ form.category.label }} *</label
                            >
                            {{ form.category }} {% if form.category.errors %}
                            <div class="text-danger small">
                                {{ form.category.errors.0 }}
                            </div>
                            {% endif %}
                        </div>
                        <div class="col-md-6 mb-3">
                            <label
                                for="{{ form.importance.id_for_label }}"
                                class="form-label"
                                >{{ form.importance.label }} *</label
                            >
                            {{ form.importance }} {% if form.importance.errors
                            %}
                            <div class="text-danger small">
                                {{ form.importance.errors.0 }}
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="mb-3">
                        <label
                            for="{{ form.content.id_for_label }}"
                            class="form-label"
                            >{{ form.content.label }} *</label
                        >
                        {{ form.content }} {% if form.content.errors %}
                        <div class="text-danger small">
                            {{ form.content.errors.0 }}
                        </div>
                        {% endif %}
                        <div class="form-text">
                            Rédigez le contenu complet de votre actualité.
                        </div>
                    </div>

                    <div class="mb-3">
                        <label
                            for="{{ form.image.id_for_label }}"
                            class="form-label"
                            >{{ form.image.label }}</label
                        >
                        {{ form.image }} {% if form.image.errors %}
                        <div class="text-danger small">
                            {{ form.image.errors.0 }}
                        </div>
                        {% endif %}
                        <div class="form-text">{{ form.image.help_text }}</div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label"
                            >{{ form.target_universities.label }}</label
                        >
                        <div class="row">
                            {% for choice in form.target_universities %}
                            <div class="col-md-4 mb-2">
                                <div class="form-check">
                                    {{ choice.tag }}
                                    <label
                                        class="form-check-label"
                                        for="{{ choice.id_for_label }}"
                                    >
                                        {{ choice.choice_label }}
                                    </label>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% if form.target_universities.errors %}
                        <div class="text-danger small">
                            {{ form.target_universities.errors.0 }}
                        </div>
                        {% endif %}
                        <div class="form-text">
                            {{ form.target_universities.help_text }}
                        </div>
                    </div>

                    <div class="border-top pt-3">
                        <div class="d-flex justify-content-between">
                            <a
                                href="{% url 'web:home' %}"
                                class="btn btn-outline-secondary"
                            >
                                <i class="fas fa-times me-1"></i>Annuler
                            </a>
                            <div>
                                <button
                                    type="submit"
                                    name="action"
                                    value="draft"
                                    class="btn btn-outline-primary me-2"
                                >
                                    <i class="fas fa-save me-1"></i>Enregistrer
                                    comme brouillon
                                </button>
                                <button
                                    type="submit"
                                    name="action"
                                    value="publish"
                                    class="btn btn-success"
                                >
                                    <i class="fas fa-paper-plane me-1"></i
                                    >Publier
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Aide -->
        <div class="card mt-3">
            <div class="card-header">
                <h6>
                    <i class="fas fa-info-circle me-1"></i>Conseils pour une
                    bonne actualité
                </h6>
            </div>
            <div class="card-body">
                <ul class="mb-0">
                    <li>
                        <strong>Titre accrocheur :</strong> Utilisez un titre
                        clair et informatif
                    </li>
                    <li>
                        <strong>Contenu structuré :</strong> Organisez votre
                        texte en paragraphes
                    </li>
                    <li>
                        <strong>Image pertinente :</strong> Ajoutez une image
                        qui illustre votre actualité
                    </li>
                    <li>
                        <strong>Catégorie appropriée :</strong> Choisissez la
                        catégorie qui correspond le mieux
                    </li>
                    <li>
                        <strong>Niveau d'importance :</strong> Évaluez
                        correctement l'urgence de votre actualité
                    </li>
                    <li>
                        <strong>Universités ciblées :</strong> Sélectionnez les
                        universités concernées
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %} {% block extra_js %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Preview de l'image
        const imageInput = document.getElementById(
            "{{ form.image.id_for_label }}"
        )
        if (imageInput) {
            imageInput.addEventListener("change", function (e) {
                const file = e.target.files[0]
                if (file) {
                    const reader = new FileReader()
                    reader.onload = function (e) {
                        let preview = document.getElementById("imagePreview")
                        if (!preview) {
                            preview = document.createElement("img")
                            preview.id = "imagePreview"
                            preview.className = "img-thumbnail mt-2"
                            preview.style.maxWidth = "200px"
                            imageInput.parentNode.appendChild(preview)
                        }
                        preview.src = e.target.result
                    }
                    reader.readAsDataURL(file)
                }
            })
        }

        // Compteur de caractères pour le titre
        const titleInput = document.getElementById(
            "{{ form.title.id_for_label }}"
        )
        if (titleInput) {
            const maxLength = 200
            const counter = document.createElement("div")
            counter.className = "form-text"
            counter.innerHTML = `<span id="titleCounter">0</span>/${maxLength} caractères`
            titleInput.parentNode.appendChild(counter)

            titleInput.addEventListener("input", function () {
                const count = this.value.length
                document.getElementById("titleCounter").textContent = count
                if (count > maxLength * 0.9) {
                    counter.classList.add("text-warning")
                } else {
                    counter.classList.remove("text-warning")
                }
            })
        }
    })
</script>
{% endblock %}
